<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  :root {
    --bg-main: #4b443f;
    --bg-card: #2b2622;
    --accent: #d4a373; /* Warm cafÃ© gold */
    --text-main: #fdfbf8;
    --text-muted: #c2b8af;
    --border: #3b342f;
    --success: #D2B48C;
    --button-hover: #D2B48C;
  }

  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-main);
    background-image: url('https://www.transparenttextures.com/patterns/food.png');
    background-repeat: repeat;
    background-blend-mode: soft-light ;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    color: var(--text-main);
  }

  header {
    text-align: center;
    padding: 20px;
    background: rgba(210, 180, 140, 0.5);
    box-shadow: 0 2px 8px rgba(0,0,0,0.25);
  }

  header h1 {
    margin: 0;
    font-size: 2.4rem;
    color: #000;
  }

  header p {
    margin: 6px 0 0;
    font-style: italic;
    font-size: 1rem;
    color: var(--text-muted);
  }

  #search-bar {
    width: 100%;
    max-width: 400px;
    margin: 20px auto 0;
    display: block;
    padding: 10px 15px;
    font-size: 16px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background-color: #2e2a26;
    color: var(--text-main);
    box-sizing: border-box;
  }

  main {
    flex: 1;
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
  }

.menu-container {
  display: flex;
  flex-direction: column;
  gap: 40px;
  flex: 2;
}
.category-section {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.category-title {
  font-size: 1.6rem;
  font-weight: 600;
  margin-bottom: 10px;
  color: #d6a57a ; /* or your theme accent */
}

.category-items {
  display: grid;
  grid-template-columns: repeat(2, 1fr); /* Exactly 2 items per row */
  gap: 20px;
}
  }

  .menu-section {
    margin-bottom: 2.5rem;
  }

  .menu-section h2 {
    font-size: 1.6rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 10px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 5px;
  }

  .menu-item {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    margin-bottom: 15px;
  }

  .menu-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.4);
  }

  .menu-content {
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .menu-content h2 {
    margin: 0;
    font-size: 1.2rem;
    color: var(--accent);
  }

  .menu-content p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-muted);
  }

  .price {
    font-weight: bold;
    color: var(--success);
  }

  .order-controls {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  .order-controls input[type="number"] {
    width: 50px;
    padding: 4px;
    text-align: center;
    background-color: #2a2522;
    color: var(--text-main);
    border: 1px solid var(--border);
    border-radius: 5px;
  }

  .qty-btn {
    background: var(--success);
    color: #fff;
    border: none;
    border-radius: 4px;
    width: 28px;
    height: 28px;
    cursor: pointer;
    font-size: 18px;
  }

  .qty-btn:hover {
    background-color: var(--button-hover);
  }

  aside#order-summary {
    flex: 1;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    max-height: 600px;
    overflow-y: auto;
    position: sticky;
    top: 30px;
    display: flex;
    flex-direction: column;
  }

  #order-summary h2 {
    margin: 0 0 10px;
    color: var(--accent);
  }

  #order-items {
    margin: 10px 0;
    flex-grow: 0;
  }

  .order-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
  }

  #total-price {
    margin-top: 10px;
    font-weight: bold;
    color: var(--success);
  }

  #table-number {
    width: 100%;
    padding: 8px;
    margin-top: 15px;
    background: #2a2522;
    color: var(--text-main);
    border: 1px solid var(--border);
    border-radius: 6px;
  }

  #place-order-btn {
    margin-top: 15px;
    width: 100%;
    padding: 12px;
    background: var(--success);
    border: none;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
  }

  #place-order-btn:hover {
    background: var(--button-hover);
  }

  #order-status-container {
    margin-top: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: bold;
    color: var(--success);
    min-height: 24px;
    margin-bottom: 10px;
    flex-shrink: 0;
  }

  #order-status-light {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background-color: grey;
    animation: blink 1.5s infinite;
    flex-shrink: 0;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
  }

  .order-fab {
    position: fixed;
    right: 20px;
    bottom: 20px;
    background: var(--accent);
    color: #000;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 26px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }

  footer {
    text-align: center;
    padding: 15px;
    background: #151210;
    color: var(--text-muted);
  }

  @media (max-width: 900px) {
    main {
      flex-direction: column;
    }
    aside#order-summary {
      position: static;
      max-height: none;
    }
  }
</style>
</head>
<body>
  <header>
    <h1>
      <img src="https://dravo08.github.io/Dravo-kholme/IMG_20250721_073902.png" alt="Cafe Kholmay Logo" style="height: 160px; vertical-align: middle; margin-right: 40px;">
      -MENU
    </h1>
  </header>

  <input id="search-bar" placeholder="Search for food..." />

  <main>
    <div class="menu-container" id="menu"></div>

    <aside id="order-summary">
      <h2>Your Order</h2>
      <div id="order-items"><p>No items selected.</p></div>

      <label for="order-description" style="display:block; margin-top: 15px; font-weight: bold;">
        Add Description (e.g., "Make it spicy"):
      </label>
      <textarea
        id="order-description"
        rows="3"
        style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; resize: vertical;"
        placeholder="Add special instructions..."
      ></textarea>

      <div id="total-price" style="margin-top:10px; font-weight:bold;">Total: Rs. 0</div>
      <input
        type="number"
        id="table-number"
        placeholder="Table Number"
        min="1"
        style="margin-top:15px;"
      />
      <button id="place-order-btn" disabled>Place Order</button>

      <div id="order-status-container" title="Real-time Kitchen Order Status" style="display:none;">
        <div id="order-status-light"></div>
        <div id="order-status-text">Order Status: N/A</div>
      </div>

      <hr style="margin:20px 0;" />

      <h3>Existing Orders</h3>
      <div
        id="existing-orders"
        style="max-height: 200px; overflow-y: auto; font-size: 0.9rem; color: #333;"
      >
        <p>No previous orders.</p>
      </div>
    </aside>
  </main>

  <div
    class="order-fab"
    onclick="document.getElementById('order-summary').scrollIntoView({behavior: 'smooth'})"
  >
    ðŸ›’
  </div>

  <footer>
    <img src="https://dravo08.github.io/Dravo-kholme/20250719_095406.png" alt="Dravo Logo" style="height: 24px; vertical-align: middle; margin-right: 8px;">
    DRAVO &copy; 2025
  </footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAvOLYaDb6pQqd4CZDfsWWsvKWDExWJ8A4",
    authDomain: "kholme-menu1.firebaseapp.com",
    databaseURL: "https://kholme-menu1-default-rtdb.firebaseio.com",
    projectId: "kholme-menu1",
    storageBucket: "kholme-menu1.firebasestorage.app",
    messagingSenderId: "434798935284",
    appId: "1:434798935284:web:527ae90b4d4833a30ff2a1",
    measurementId: "G-9XG8BZ9YXK"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const menuRef = ref(db, 'menu');
  const ordersRef = ref(db, 'orders');
  const menuDiv = document.getElementById('menu');
  const searchBar = document.getElementById('search-bar');

  const orderSelections = {};

  function getOrCreateCustomerId() {
    let id = localStorage.getItem('customerId');
    if (!id) {
      id = 'cust-' + Math.random().toString(36).substring(2, 10);
      localStorage.setItem('customerId', id);
    }
    return id;
  }
  const customerId = getOrCreateCustomerId();

  function updateOrderSummary() {
    const orderItemsDiv = document.getElementById('order-items');
    const totalPriceDiv = document.getElementById('total-price');
    const placeOrderBtn = document.getElementById('place-order-btn');
    const tableInput = document.getElementById('table-number');

    const selectedItems = Object.values(orderSelections).filter(
      (item) => item.selected && item.quantity > 0
    );

    if (selectedItems.length === 0) {
      orderItemsDiv.innerHTML = '<p>No items selected.</p>';
      totalPriceDiv.textContent = 'Total: Rs. 0';
      placeOrderBtn.disabled = true;
      return;
    }

    orderItemsDiv.innerHTML = '';
    let total = 0;
    selectedItems.forEach((item) => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'order-item';
      itemDiv.textContent = `${item.name} x ${item.quantity}`;
      orderItemsDiv.appendChild(itemDiv);
      total += item.price * item.quantity;
    });

    totalPriceDiv.textContent = `Total: Rs. ${total}`;
    placeOrderBtn.disabled = !tableInput.value || Number(tableInput.value) < 1;
  }

  function createMenuItem(id, item) {
    const div = document.createElement('div');
    div.className = 'menu-item';
    div.innerHTML = `
      <div class="menu-content">
        <h2>${item.name}</h2>
        <p>${item.description || ''}</p>
        <div class="price">Rs. ${item.price}</div>
        <div class="order-controls">
          <label><input type="checkbox" id="select-${id}"> Add</label>
          <label>
            Qty:
            <button type="button" class="qty-btn" data-action="decrease">-</button>
            <input type="number" id="qty-${id}" min="0" value="0" disabled>
            <button type="button" class="qty-btn" data-action="increase">+</button>
          </label>
        </div>
      </div>
    `;

    const checkbox = div.querySelector(`#select-${id}`);
    const qtyInput = div.querySelector(`#qty-${id}`);
    const minusBtn = div.querySelector(`.qty-btn[data-action="decrease"]`);
    const plusBtn = div.querySelector(`.qty-btn[data-action="increase"]`);

    checkbox.addEventListener('change', () => {
      if (checkbox.checked) {
        qtyInput.disabled = false;
        if (Number(qtyInput.value) === 0) qtyInput.value = 1;
        orderSelections[id] = {
          selected: true,
          quantity: Number(qtyInput.value),
          price: Number(item.price),
          name: item.name,
        };
      } else {
        qtyInput.disabled = true;
        qtyInput.value = 0;
        orderSelections[id] = { selected: false, quantity: 0 };
      }
      updateOrderSummary();
    });

    qtyInput.addEventListener('input', () => {
      let val = Number(qtyInput.value);
      if (isNaN(val) || val < 0) val = 0;
      qtyInput.value = val;
      if (val === 0) {
        checkbox.checked = false;
        qtyInput.disabled = true;
        orderSelections[id] = { selected: false, quantity: 0 };
      } else {
        checkbox.checked = true;
        qtyInput.disabled = false;
        orderSelections[id] = {
          selected: true,
          quantity: val,
          price: Number(item.price),
          name: item.name,
        };
      }
      updateOrderSummary();
    });

    minusBtn.addEventListener('click', () => {
      let val = Number(qtyInput.value) || 0;
      if (val > 0) val--;
      qtyInput.value = val;
      qtyInput.dispatchEvent(new Event('input'));
    });

    plusBtn.addEventListener('click', () => {
      let val = Number(qtyInput.value) || 0;
      val++;
      qtyInput.value = val;
      qtyInput.dispatchEvent(new Event('input'));
    });

    return div;
  }

  onValue(menuRef, (snapshot) => {
  const data = snapshot.val();
  const menuDiv = document.getElementById('menu');
  menuDiv.innerHTML = '';

  const categories = {};
  for (let id in data) {
    const item = data[id];
    if (!categories[item.category]) categories[item.category] = [];
    categories[item.category].push({ id, ...item });
  }

  for (let category in categories) {
    const section = document.createElement('section');
    section.className = 'category-section';

    const title = document.createElement('h2');
    title.className = 'category-title';
    title.textContent = category;
    section.appendChild(title);

    const itemsContainer = document.createElement('div');
    itemsContainer.className = 'category-items';

    categories[category].forEach((item) => {
      const itemDiv = createMenuItem(item.id, item);
      itemsContainer.appendChild(itemDiv);
    });

    section.appendChild(itemsContainer);
    menuDiv.appendChild(section);
  }

  updateOrderSummary();
}); 
  document.getElementById('table-number').addEventListener('input', updateOrderSummary);

  searchBar.addEventListener('input', () => {
    const q = searchBar.value.toLowerCase();
    const items = document.querySelectorAll('.menu-item');
    items.forEach((item) => {
      const name = item.querySelector('h2').textContent.toLowerCase();
      item.style.display = name.includes(q) ? '' : 'none';
    });
  });

  function cleanupOldCancelledOrders() {
    onValue(
      ordersRef,
      (snapshot) => {
        const data = snapshot.val() || {};
        const now = Date.now();
        for (const id in data) {
          const order = data[id];
          if (order.status === 'cancelled' && now - order.timestamp > 24 * 60 * 60 * 1000) {
            remove(ref(db, `orders/${id}`));
          }
        }
      },
      { onlyOnce: true }
    );
  }
  // Place order button logic
  const placeOrderBtn = document.getElementById('place-order-btn');
  placeOrderBtn.addEventListener('click', async () => {
    const tableNumber = document.getElementById('table-number').value.trim();
    const description = document.getElementById('order-description').value.trim();
    if (!tableNumber || Number(tableNumber) < 1) {
      alert('Please enter a valid table number.');
      return;
    }

    const selectedItems = Object.entries(orderSelections)
      .filter(([_, item]) => item.selected && item.quantity > 0)
      .map(([id, item]) => ({
        id,
        name: item.name,
        quantity: item.quantity,
        price: item.price,
      }));

    if (selectedItems.length === 0) {
      alert('Please select at least one item.');
      return;
    }

    const newOrder = {
      customerId,
      tableNumber: Number(tableNumber),
      description: description || '',
      items: selectedItems,
      status: 'pending',
      timestamp: Date.now(),
    };

    try {
      await push(ordersRef, newOrder);
      alert('Order placed successfully!');
      // Reset form
      document.getElementById('order-description').value = '';
      document.getElementById('table-number').value = '';
      for (const id in orderSelections) {
        orderSelections[id] = { selected: false, quantity: 0 };
        const checkbox = document.getElementById(`select-${id}`);
        const qtyInput = document.getElementById(`qty-${id}`);
        if (checkbox) checkbox.checked = false;
        if (qtyInput) {
          qtyInput.value = 0;
          qtyInput.disabled = true;
        }
      }
      updateOrderSummary();
    } catch (error) {
      console.error('Error placing order:', error);
      alert('Failed to place order. Please try again.');
    }
  });

  // Real-time update of existing orders list
  const existingOrdersDiv = document.getElementById('existing-orders');
  onValue(ordersRef, (snapshot) => {
    const orders = snapshot.val();
    existingOrdersDiv.innerHTML = '';
    if (!orders) {
      existingOrdersDiv.innerHTML = '<p>No previous orders.</p>';
      return;
    }

    // Convert to array and sort by timestamp desc
    const ordersArray = Object.entries(orders).sort(
      (a, b) => b[1].timestamp - a[1].timestamp
    );

    ordersArray.forEach(([orderId, order]) => {
      const div = document.createElement('div');
      div.style.marginBottom = '10px';
      div.style.paddingBottom = '10px';
      div.style.borderBottom = '1px solid var(--border)';
      div.style.color = 'var(--text-main)';
      div.innerHTML = `
        <strong>Table ${order.tableNumber}</strong> - Status: ${order.status}<br>
        Items: ${order.items
          .map((i) => `${i.name} x${i.quantity}`)
          .join(', ')}<br>
        ${order.description ? `<em>Note: ${order.description}</em>` : ''}
      `;
      existingOrdersDiv.appendChild(div);
    });
  });

  // Real-time kitchen order status light (simple simulation)
  // You can extend this logic to reflect real statuses from DB
  const orderStatusContainer = document.getElementById('order-status-container');
  const orderStatusLight = document.getElementById('order-status-light');
  const orderStatusText = document.getElementById('order-status-text');

  onValue(ordersRef, (snapshot) => {
    const orders = snapshot.val() || {};
    // Show light if there is any pending or processing order
    const hasActiveOrders = Object.values(orders).some(
      (order) => order.status === 'pending' || order.status === 'processing'
    );

    if (hasActiveOrders) {
      orderStatusContainer.style.display = 'flex';
      orderStatusLight.style.backgroundColor = '#D2B48C'; // Warm gold for active
      orderStatusText.textContent = 'Order Status: Active Orders Present';
    } else {
      orderStatusContainer.style.display = 'flex';
      orderStatusLight.style.backgroundColor = 'grey';
      orderStatusText.textContent = 'Order Status: No Active Orders';
    }
  });

  cleanupOldCancelledOrders();

</script>
</body>
</html>
